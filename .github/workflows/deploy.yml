name: Deploy via FTP

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate secrets
        run: |
          test -n "${{ secrets.FTP_HOST }}"        || (echo "FTP_HOST missing" && exit 1)
          test -n "${{ secrets.FTP_USER }}"        || (echo "FTP_USER missing" && exit 1)
          test -n "${{ secrets.FTP_PASS }}"        || (echo "FTP_PASS missing" && exit 1)
          test -n "${{ secrets.FTP_PORT }}"        || (echo "FTP_PORT missing" && exit 1)
          test -n "${{ secrets.FTP_REMOTE_DIR }}"  || (echo "FTP_REMOTE_DIR missing" && exit 1)
          case "${{ secrets.FTP_REMOTE_DIR }}" in
            */) echo "server dir ok";;
            *)  echo "FTP_REMOTE_DIR must end with /"; exit 1;;
          esac

      - name: Deploy via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server:   ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          port:     ${{ secrets.FTP_PORT }}   # معمولا 21
          protocol: ftp
          local-dir: ./
          # نکته مهم: اگر لاگین FTP دقیقا داخل پوشه تم باز می‌شود، این مقدار را "./" بگذار.
          # اگر بالاتر (مثل public_html یا mag) باز می‌شود، مسیر نسبی تا پوشه تم را بده، مثل:
          # public_html/wp-content/themes/yourtheme/
          server-dir: ${{ secrets.FTP_REMOTE_DIR }}
          # اگر می‌خواهی فولدر تم روی سرور 100% آینه‌ی ریپو شود (فایل اضافی پاک شود) این را true کن:
          dangerous-clean-slate: true
          exclude: |
            **/.git/**
            **/.git*
            **/.github/**
            **/node_modules/**
            **/vendor/**
            **/*.map
            wp-content/uploads/**

